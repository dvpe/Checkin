<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Check-in Unimed - Campanha Escolas Araucária 2025</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <style>
        /* Reset e Configurações Básicas */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #00a859 0%, #00d170 50%, #00f58c 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            z-index: -1;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Estilo do Cabeçalho */
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .logo {
            width: 200px;
            height: auto;
            margin-bottom: 25px;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.4);
            font-weight: 800;
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            margin-bottom: 8px;
            font-weight: 400;
        }

        .valor-destaque {
            font-size: 2.5rem;
            font-weight: 800;
            margin-top: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Métricas */
        .metrics-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 45px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.98);
            color: #00a859;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .metric-number {
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 12px;
            color: #00a859;
        }

        .metric-label {
            font-size: 1rem;
            opacity: 0.85;
            color: #00d170;
            font-weight: 500;
        }

        /* Estilo da Seção de Check-in */
        .checkin-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 45px;
            border: 2px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .simulation-title {
            font-size: 2.2rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
        }

        .checkin-form {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: flex-end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            min-width: 280px;
            flex-grow: 1;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .form-group select {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            background: white;
            color: #00a859;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: 500;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .form-group select:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .controls button {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-checkin {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
        }

        .btn-checkin:hover {
            background: linear-gradient(45deg, #059669, #047857);
            transform: translateY(-3px);
        }

        .btn-simulate {
            background: linear-gradient(45deg, #ffffff, #f5f5f5);
            color: #00a859;
        }

        .btn-simulate:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .btn-clear {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.4);
        }

        .btn-clear:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: translateY(-3px);
        }

        /* Van Info */
        .van-info {
            display: none;
            padding: 20px;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }

        .van-photo {
            width: 200px;
            height: 150px;
            object-fit: contain;
            border-radius: 10px;
            background: white;
            padding: 10px;
        }

        /* Mapa */
        .simulation-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 45px;
            border: 2px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        #map {
            width: 100%;
            height: 600px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            margin-bottom: 25px;
            border: 3px solid rgba(255, 255, 255, 0.2);
        }

        .status-container {
            background: rgba(255, 255, 255, 0.12);
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            backdrop-filter: blur(10px);
        }

        #status {
            text-align: center;
            padding: 25px;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Estilo da Seção de Cards */
        .cards-section {
            margin-top: 40px;
        }

        .section-title {
            font-size: 2.2rem;
            margin-bottom: 30px;
            font-weight: 700;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        #cards-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .city-card {
            background: rgba(255, 255, 255, 0.98);
            color: #00a859;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
            border: 2px solid #00d170;
            transition: transform 0.3s ease;
        }

        .city-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        .city-header {
            border-bottom: 3px solid #e0f2e9;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .city-name {
            font-size: 2.5rem;
            font-weight: 800;
            color: #00a859;
            line-height: 1.2;
        }

        .vehicle-count {
            font-size: 1.2rem;
            font-weight: 600;
            color: #00d170;
            margin-top: 5px;
        }

        /* Galeria de Vans */
        .vans-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .van-gallery-item {
            background: #ffffff;
            border: 1px solid #e0f2e9;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            transition: box-shadow 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .van-gallery-item:hover {
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .van-gallery-photo {
            width: 100%;
            height: 200px;
            object-fit: contain;
            display: block;
            transition: transform 0.5s ease;
            background: #f8fafc;
        }

        .van-gallery-item:hover .van-gallery-photo {
            transform: scale(1.05);
        }

        .van-gallery-info {
            padding: 15px;
            font-size: 0.95rem;
            line-height: 1.5;
            color: #00a859;
        }

        /* Estilo do Dropdown de Escolas */
        .escolas-dropdown {
            margin-top: 10px;
            border-top: 1px solid #e0f2e9;
            padding: 10px 0;
            color: #00d170;
        }

        .escolas-dropdown summary {
            font-weight: 700;
            cursor: pointer;
            list-style: none;
            padding: 5px 0;
            transition: color 0.3s ease;
        }

        .escolas-dropdown summary:hover {
            color: #00a859;
        }

        .escolas-dropdown summary::after {
            content: ' ▼';
            font-size: 0.8em;
        }

        .escolas-dropdown[open] summary::after {
            content: ' ▲';
        }

        .escolas-list ul {
            margin-top: 10px;
            padding-left: 20px;
        }

        .escolas-list li {
            margin: 5px 0;
            color: #00a859;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .valor-destaque {
                font-size: 1.8rem;
            }

            .city-name {
                font-size: 1.8rem;
            }

            .vans-gallery {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Cabeçalho -->
        <div class="header">
            <img src="https://raw.githubusercontent.com/dvpe/Checkin/refs/heads/main/logos/Unimed.png" alt="Logo Unimed" class="logo">
            <h1>Sistema de Check-in - Campanha Unimed</h1>
            <p>📍 Escolas de Araucária</p>
            <p>📅 Campanha 2025</p>
            <p class="valor-destaque">💰 Investimento Total: R$ 13.068,00</p>
        </div>

        <!-- Métricas -->
        <div class="metrics-container">
            <div class="metric-card">
                <div class="metric-number">11</div>
                <div class="metric-label">Total de Veículos</div>
            </div>
            <div class="metric-card">
                <div class="metric-number">51</div>
                <div class="metric-label">Escolas Atendidas</div>
            </div>
            <div class="metric-card">
                <div class="metric-number">1</div>
                <div class="metric-label">Cidade Coberta</div>
            </div>
            <div class="metric-card">
                <div class="metric-number">R$ 1.188</div>
                <div class="metric-label">Investimento por Van</div>
            </div>
        </div>

        <!-- Seção de Check-in -->
        <div class="checkin-section">
            <h2 class="simulation-title">📋 Sistema de Check-in das Vans</h2>
            <div class="checkin-form">
                <div class="form-group">
                    <label for="citySelect">Selecione a Cidade:</label>
                    <select id="citySelect">
                        <option value="">-- Escolha uma cidade --</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="vanSelect">Selecione a Van:</label>
                    <select id="vanSelect" disabled>
                        <option value="">-- Primeiro selecione uma cidade --</option>
                    </select>
                </div>
            </div>

            <div id="vanInfo" class="van-info">
                <h3 style="font-size: 1.5rem; margin-bottom: 15px;">Informações da Van Selecionada</h3>
                <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                    <img id="vanPhoto" class="van-photo" src="" alt="Foto da Van">
                    <div style="line-height: 1.8;">
                        <p><strong>Condutor:</strong> <span id="vanDriver"></span></p>
                        <p><strong>Telefone:</strong> <span id="vanPhone"></span></p>
                        <p><strong>Placa:</strong> <span id="vanPlate"></span></p>
                        <p><strong>Endereço da Garagem:</strong> <span id="vanGarage"></span></p>
                    </div>
                </div>
            </div>

            <div class="controls">
                <button class="btn-checkin" onclick="realizarCheckin()">📍 Realizar Check-in</button>
                <button class="btn-simulate" onclick="simularTodasRotas()">🚐 Simular Todas as Rotas</button>
                <button class="btn-clear" onclick="limparMapa()">🧹 Limpar Mapa</button>
            </div>
        </div>

        <!-- Seção do Mapa -->
        <div class="simulation-section">
            <h2 class="simulation-title">🗺️ Mapa Interativo das Rotas</h2>
            <div id="map"></div>
            <div class="status-container">
                <div id="status">
                    🗺️ Selecione uma cidade e van para visualizar as rotas e realizar check-in
                </div>
            </div>
        </div>

        <!-- Seção de Cards -->
        <div class="cards-section">
            <h2 class="section-title">📊 Detalhamento por Cidade</h2>
            <div id="cards-container"></div>
        </div>
    </div>

    <script>
        let map;
        let directionsService;
        let directionsRenderer = [];
        let markers = [];
        let currentCity = '';
        let currentVan = null;
        let simulationInProgress = false;

        const GOOGLE_MAPS_API_KEY = 'AIzaSyBDKTnVRwJ0CwotEFufK4maf9L0i-27M04';
        const ICON_ESCOLA = 'https://raw.githubusercontent.com/dvpe/Checkin/main/icones/escola.png';
        const ICON_VAN_INDO = 'https://raw.githubusercontent.com/dvpe/Checkin/main/icones/indo.png';

        // Dados da campanha Unimed
        const cidadesData = {
            "Araucaria": {
                "center": {
                    "lat": -25.5934,
                    "lng": -49.4094,
                    "zoom": 13
                },
                "vans": [
                    {
                        "condutor": "Lucas Mikuska da Rosa",
                        "telefone": "41999990991",
                        "placa": "AUA1G36",
                        "destino": "Escola Archelau, Escola Silda Sally, Cmei Gilca, Cmei Torres, Cmei cachoeira, Colégio Helena, Colégio Marilze",
                        "endereco_garagem": "Rua Espírito Santo, 416",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/AUA1G36.jpg",
                        "escolas": ["Escola Archelau", "Escola Silda Sally", "Cmei Gilca", "Cmei Torres", "Cmei cachoeira", "Colégio Helena", "Colégio Marilze"]
                    },
                    {
                        "condutor": "Washington Luiz Carmo de Oliveira",
                        "telefone": "41995086457",
                        "placa": "MKN9F77",
                        "destino": "Archelau, verkas, jardim conhecimento, jardim cachoeira, shimanski, CMEI - Centro Municipal de Educação Infantil Jardim das Araucárias, CMEI torres, Terezinha",
                        "endereco_garagem": "Rua amarillis 211",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/MKB9F77.jpg",
                        "escolas": ["Archelau", "verkas", "jardim conhecimento", "jardim cachoeira", "shimanski", "CMEI - Centro Municipal de Educação Infantil Jardim das Araucárias", "CMEI torres", "Terezinha"]
                    },
                    {
                        "condutor": "RODRIGO BORDIGNON",
                        "telefone": "41985054548",
                        "placa": "AUB-8H21",
                        "destino": "Escola Municipal Professora Maria Aparecida Saliba Torres, Colégio Estadual, Prof. Maria da Graça Siqueira Silva, Lima Colégio Estadual Profª Helena Wysocki-EFM, EM - Escola Municipal Sebastião Tavares da Silva",
                        "endereco_garagem": "Leonardo Piska 173",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/AUB8H21.jpg",
                        "escolas": ["Escola Municipal Professora Maria Aparecida Saliba Torres", "Colégio Estadual", "Prof. Maria da Graça Siqueira Silva", "Lima Colégio Estadual Profª Helena Wysocki-EFM", "EM - Escola Municipal Sebastião Tavares da Silva"]
                    },
                    {
                        "condutor": "Edson Gotfrid",
                        "telefone": "41999777394",
                        "placa": "SDR6E69",
                        "destino": "Colégio Estadual do Campo Ana Maria V. Kava",
                        "endereco_garagem": "Rua Alberto Karas 946",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/SDR6E69.jpg",
                        "escolas": ["Colégio Estadual do Campo Ana Maria V. Kava"]
                    },
                    {
                        "condutor": "Edson Gotfrid",
                        "telefone": "41999777394",
                        "placa": "QHF7B97",
                        "destino": "Escola Municipal do Campo Professora Andréa Maria Scherreier Dias",
                        "endereco_garagem": "Rua Alberto Karas 946",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/SDR6E69.jpg",
                        "escolas": ["Escola Municipal do Campo Professora Andréa Maria Scherreier Dias"]
                    },
                    {
                        "condutor": "Edson Gotfrid",
                        "telefone": "41999777394",
                        "placa": "AZW8G19",
                        "destino": "Escola Elvira buschmann",
                        "endereco_garagem": "Rua Alberto Karas 946",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/AZW8G19.jpg",
                        "escolas": ["Escola Elvira buschmann"]
                    },
                    {
                        "condutor": "Edson Gotfrid",
                        "telefone": "41999777394",
                        "placa": "AXC3J24",
                        "destino": "Escola Municipal Professora Maria Aparecida Saliba Torres, Colégio Estadual Prof. Maria da Graça Siqueira Silva e Lima, Colégio Estadual Profª Helena Wysocki-EFM, EM - Escola Municipal Sebastião Tavares da Silva",
                        "endereco_garagem": "Rua Alberto Karas 946",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/AXC3J24.jpg",
                        "escolas": ["Escola Municipal Professora Maria Aparecida Saliba Torres", "Colégio Estadual Prof. Maria da Graça Siqueira Silva e Lima", "Colégio Estadual Profª Helena Wysocki-EFM", "EM - Escola Municipal Sebastião Tavares da Silva"]
                    },
                    {
                        "condutor": "Edmara Aparecida Santos de Oliveira",
                        "telefone": "41992223950",
                        "placa": "AWD4B29",
                        "destino": "Escolas Maria Aparecida, Maria da Graça, Sebastião Tavares, Helena, Archelau de Almeida torres, Ceso, Cmeis Dorinha, Araucária, Paneke",
                        "endereco_garagem": "Rua Francisco Dreweniak número 309",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/AWD.jpg",
                        "escolas": ["Escolas Maria Aparecida", "Maria da Graça", "Sebastião Tavares", "Helena", "Archelau de Almeida torres", "Ceso", "Cmeis Dorinha", "Araucária", "Paneke"]
                    },
                    {
                        "condutor": "Washington Luiz Carmo de Oliveira",
                        "telefone": "41995086457",
                        "placa": "MLF6A87",
                        "destino": "Archelau, verkas, jardim conhecimento, jardim cachoeira, shimanski, CMEI - Centro Municipal de Educação Infantil Jardim das Araucárias, CMEI torres, Terezinha",
                        "endereco_garagem": "Rua amarillis 211",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/MLF6A87.jpg",
                        "escolas": ["Archelau", "verkas", "jardim conhecimento", "jardim cachoeira", "shimanski", "CMEI - Centro Municipal de Educação Infantil Jardim das Araucárias", "CMEI torres", "Terezinha"]
                    },
                    {
                        "condutor": "Rogério Siqueira",
                        "telefone": "4197601047",
                        "placa": "AWL1B87",
                        "destino": "Euvira, Dellani, CAIC, Arlindo, Rocha pombo, Ambrósio",
                        "endereco_garagem": "Rua beija flor 920",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/AWL1887.jpg",
                        "escolas": ["Euvira", "Dellani", "CAIC", "Arlindo", "Rocha pombo", "Ambrósio"]
                    },
                    {
                        "condutor": "Rogério Siqueira",
                        "telefone": "4197601047",
                        "placa": "AWC5H40",
                        "destino": "CMEI Tereza dias, CMEI Alice, CMEI Rose, CMEI Plínio, CMEI Tereza de benguela, CMEI Norma, CMEI Califórnia",
                        "endereco_garagem": "Rua beija flor 920",
                        "local_fotos": "https://raw.githubusercontent.com/dvpe/Checkin/main/unimed/AWC5H4.jpg",
                        "escolas": ["CMEI Tereza dias", "CMEI Alice", "CMEI Rose", "CMEI Plínio", "CMEI Tereza de benguela", "CMEI Norma", "CMEI Califórnia"]
                    }
                ],
                "total_escolas": 51
            }
        };

        // Inicializar o mapa
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -25.5934, lng: -49.4094 },
                zoom: 13,
                mapTypeId: 'roadmap'
            });

            directionsService = new google.maps.DirectionsService();

            // Preencher dropdown de cidades
            const citySelect = document.getElementById('citySelect');
            Object.keys(cidadesData).forEach(cidade => {
                const option = document.createElement('option');
                option.value = cidade;
                option.textContent = cidade;
                citySelect.appendChild(option);
            });

            // Gerar cards das cidades
            gerarCards();
        }

        // Quando seleciona uma cidade
        document.getElementById('citySelect').addEventListener('change', function() {
            const cidade = this.value;
            currentCity = cidade;

            const vanSelect = document.getElementById('vanSelect');
            vanSelect.innerHTML = '<option value="">-- Escolha uma van --</option>';

            if (cidade && cidadesData[cidade]) {
                vanSelect.disabled = false;
                const vans = cidadesData[cidade].vans;

                vans.forEach((van, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${van.placa} - ${van.condutor}`;
                    vanSelect.appendChild(option);
                });

                // Centralizar mapa na cidade
                const center = cidadesData[cidade].center;
                map.setCenter({ lat: center.lat, lng: center.lng });
                map.setZoom(center.zoom);
            } else {
                vanSelect.disabled = true;
                document.getElementById('vanInfo').style.display = 'none';
            }
        });

        // Quando seleciona uma van
        document.getElementById('vanSelect').addEventListener('change', function() {
            const vanIndex = this.value;

            if (vanIndex !== '' && currentCity && cidadesData[currentCity]) {
                currentVan = cidadesData[currentCity].vans[vanIndex];

                // Mostrar informações da van
                document.getElementById('vanPhoto').src = currentVan.local_fotos;
                document.getElementById('vanDriver').textContent = currentVan.condutor;
                document.getElementById('vanPhone').textContent = currentVan.telefone;
                document.getElementById('vanPlate').textContent = currentVan.placa;
                document.getElementById('vanGarage').textContent = currentVan.endereco_garagem;
                document.getElementById('vanInfo').style.display = 'block';
            } else {
                document.getElementById('vanInfo').style.display = 'none';
                currentVan = null;
            }
        });

        // Realizar check-in
        function realizarCheckin() {
            if (!currentCity || !currentVan) {
                alert('Por favor, selecione uma cidade e uma van primeiro!');
                return;
            }

            limparMapa();

            const status = document.getElementById('status');
            status.innerHTML = `<strong>🚐 Check-in realizado!</strong><br>Van ${currentVan.placa} - ${currentVan.condutor}<br>Cidade: ${currentCity}`;

            // Adicionar marcador da garagem
            const garagemAddress = currentVan.endereco_garagem + ', ' + currentCity + ', PR, Brasil';

            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: garagemAddress }, function(results, status) {
                if (status === 'OK') {
                    const garagemLocation = results[0].geometry.location;

                    // Marcador da garagem
                    const garagemMarker = new google.maps.Marker({
                        position: garagemLocation,
                        map: map,
                        icon: {
                            url: ICON_VAN_INDO,
                            scaledSize: new google.maps.Size(40, 40),
                            origin: new google.maps.Point(0, 0),
                            anchor: new google.maps.Point(20, 20)
                        },
                        title: 'Garagem - ' + currentVan.endereco_garagem
                    });
                    markers.push(garagemMarker);

                    // Adicionar marcadores das escolas e traçar rotas
                    let waypoints = [];
                    currentVan.escolas.forEach((escola, index) => {
                        const escolaAddress = escola + ', ' + currentCity + ', PR, Brasil';

                        geocoder.geocode({ address: escolaAddress }, function(results, status) {
                            if (status === 'OK') {
                                const escolaMarker = new google.maps.Marker({
                                    position: results[0].geometry.location,
                                    map: map,
                                    icon: {
                                        url: ICON_ESCOLA,
                                        scaledSize: new google.maps.Size(35, 35),
                                        origin: new google.maps.Point(0, 0),
                                        anchor: new google.maps.Point(17, 17)
                                    },
                                    title: escola,
                                    label: {
                                        text: String(index + 1),
                                        color: 'white',
                                        fontWeight: 'bold',
                                        fontSize: '12px'
                                    }
                                });
                                markers.push(escolaMarker);

                                // Adicionar aos waypoints para rota
                                waypoints.push({
                                    location: results[0].geometry.location,
                                    stopover: true
                                });

                                // Quando todas as escolas forem geocodificadas, traçar a rota
                                if (waypoints.length === currentVan.escolas.length) {
                                    tracarRota(garagemLocation, waypoints);
                                }
                            }
                        });
                    });

                    // Centralizar no local da garagem
                    map.setCenter(garagemLocation);
                    map.setZoom(14);
                } else {
                    alert('Não foi possível geocodificar o endereço da garagem.');
                }
            });
        }

        // Traçar rota
        function tracarRota(origem, waypoints) {
            if (waypoints.length === 0) return;

            const renderer = new google.maps.DirectionsRenderer({
                map: map,
                suppressMarkers: true,
                polylineOptions: {
                    strokeColor: '#00a859',
                    strokeWeight: 4,
                    strokeOpacity: 0.7
                }
            });
            directionsRenderer.push(renderer);

            const request = {
                origin: origem,
                destination: origem, // Volta para a garagem
                waypoints: waypoints,
                travelMode: 'DRIVING',
                optimizeWaypoints: true
            };

            directionsService.route(request, function(result, status) {
                if (status === 'OK') {
                    renderer.setDirections(result);
                }
            });
        }

        // Simular todas as rotas
        function simularTodasRotas() {
            if (simulationInProgress) {
                alert('Simulação já em andamento!');
                return;
            }

            limparMapa();
            simulationInProgress = true;

            const status = document.getElementById('status');
            status.innerHTML = '<strong>🔄 Simulando todas as rotas...</strong>';

            Object.entries(cidadesData).forEach(([cidade, data]) => {
                data.vans.forEach((van, vanIndex) => {
                    setTimeout(() => {
                        const garagemAddress = van.endereco_garagem + ', ' + cidade + ', PR, Brasil';
                        const geocoder = new google.maps.Geocoder();

                        geocoder.geocode({ address: garagemAddress }, function(results, status) {
                            if (status === 'OK') {
                                const garagemLocation = results[0].geometry.location;

                                const marker = new google.maps.Marker({
                                    position: garagemLocation,
                                    map: map,
                                    icon: {
                                        url: ICON_VAN_INDO,
                                        scaledSize: new google.maps.Size(40, 40),
                                        origin: new google.maps.Point(0, 0),
                                        anchor: new google.maps.Point(20, 20)
                                    },
                                    title: `${cidade} - ${van.placa}`,
                                    label: {
                                        text: van.placa,
                                        color: 'white',
                                        fontWeight: 'bold',
                                        fontSize: '10px'
                                    }
                                });
                                markers.push(marker);

                                // Adicionar marcadores das escolas
                                let waypoints = [];
                                van.escolas.forEach((escola) => {
                                    const escolaAddress = escola + ', ' + cidade + ', PR, Brasil';
                                    geocoder.geocode({ address: escolaAddress }, function(results, status) {
                                        if (status === 'OK') {
                                            const escolaMarker = new google.maps.Marker({
                                                position: results[0].geometry.location,
                                                map: map,
                                                icon: {
                                                    url: ICON_ESCOLA,
                                                    scaledSize: new google.maps.Size(30, 30),
                                                    origin: new google.maps.Point(0, 0),
                                                    anchor: new google.maps.Point(15, 15)
                                                },
                                                title: escola
                                            });
                                            markers.push(escolaMarker);

                                            waypoints.push({
                                                location: results[0].geometry.location,
                                                stopover: true
                                            });

                                            if (waypoints.length === van.escolas.length) {
                                                tracarRota(garagemLocation, waypoints);
                                            }
                                        }
                                    });
                                });
                            }
                        });
                    }, vanIndex * 500);
                });
            });

            setTimeout(() => {
                simulationInProgress = false;
                status.innerHTML = `<strong>✅ Simulação concluída!</strong><br>Todas as rotas foram mapeadas.`;
            }, 3000);
        }

        // Limpar mapa
        function limparMapa() {
            markers.forEach(marker => marker.setMap(null));
            markers = [];

            directionsRenderer.forEach(renderer => renderer.setMap(null));
            directionsRenderer = [];

            document.getElementById('status').innerHTML = '🗺️ Mapa limpo. Selecione uma cidade e van para começar.';
        }

        // Gerar cards das cidades
        function gerarCards() {
            const container = document.getElementById('cards-container');
            container.innerHTML = '';

            Object.entries(cidadesData).forEach(([cidade, data]) => {
                const card = document.createElement('div');
                card.className = 'city-card';

                let vansHTML = '';
                data.vans.forEach(van => {
                    const escolasListHTML = van.escolas.map(e => `<li>${e}</li>`).join('');

                    vansHTML += `
                        <div class="van-gallery-item">
                            <img src="${van.local_fotos}" alt="Van ${van.placa}" class="van-gallery-photo" onerror="this.style.display='none'">
                            <div class="van-gallery-info">
                                <strong>Placa:</strong> ${van.placa}<br>
                                <strong>Condutor:</strong> ${van.condutor}<br>
                                <strong>Telefone:</strong> ${van.telefone}<br>
                                <strong>Garagem:</strong> ${van.endereco_garagem}
                                <details class="escolas-dropdown">
                                    <summary>Ver Escolas (${van.escolas.length})</summary>
                                    <div class="escolas-list">
                                        <ul>${escolasListHTML}</ul>
                                    </div>
                                </details>
                            </div>
                        </div>
                    `;
                });

                card.innerHTML = `
                    <div class="city-header">
                        <div class="city-name">${cidade}</div>
                        <div class="vehicle-count">${data.vans.length} veículo(s) • ${data.total_escolas} escola(s)</div>
                    </div>
                    <div class="vans-gallery">
                        ${vansHTML}
                    </div>
                `;

                container.appendChild(card);
            });
        }
    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBDKTnVRwJ0CwotEFufK4maf9L0i-27M04&callback=initMap"></script>
</body>

</html>

